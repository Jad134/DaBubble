<section [ngClass]="{ 'd-none': isSmallScreen || threadService.closeTab}">
  <div class="thread-container">
    <div class="thread-head">
      <div class="head-text">
        <h2>Thread</h2>
        <p>#</p>
        <p>Entwicklerteam</p>
      </div>
      <div class="close w-h-40" (click)="Dnone()"></div>
    </div>

    <div class="chat">
      <ng-container *ngFor="let messageObj of threadService.chatDatas; let i = index">
        <!-- Überprüfe, ob der vorherige Eintrag existiert und das Datum anders ist -->
        <ng-container
          *ngIf="i === 0 || (threadService.chatDatas[i - 1].time | date:'dd.MM.yyyy') !== (messageObj.time | date:'dd.MM.yyyy')">
          <div class="date-div">
            <div class="line"></div>
            <span class="date">{{ messageObj.time | date:'dd.MM.yyyy' }}</span>
            <div class="line"></div>
          </div>
        </ng-container>

        <div (mouseover)="showButton[i] = true" (mouseleave)="showButton[i] = false"
          [ngClass]="messageObj.ownMessage ? 'you-chat-message' : 'chat-message'" class="chat-message">
          <div *ngIf="messageObj?.message" class="message-avatar"><img class="message-avatar"
              [src]="getUserAvatar(messageObj.user.id)" (click)="openUserDetail(messageObj.user)"></div>
          <div *ngIf="messageObj?.message">
            <div [ngClass]="messageObj.ownMessage ? 'you-name-time-div': 'name-time-div'">
              <span *ngIf="messageObj.user.name" class="name" (click)="openUserDetail(messageObj.user)">{{
                messageObj.user.name }}</span>
              <span class="time">{{ messageObj.time | date:'HH:mm' }}</span>
            </div>
            <div [ngClass]="messageObj.ownMessage ? 'you-message': 'message'">{{ messageObj.message }}</div>
            <div [ngClass]="messageObj.ownMessage ? 'own-message-reaction': 'message-reaction'">
              <mat-icon (click)="openEmojiDialog($event, false, true, messageObj.time)"
                class="add-reaction-icon">add_reaction</mat-icon>
                <div *ngIf="messageObj.emoji.length > 0" class="show-reactions-container">
                  <div (click)="addCurrentReaction(messageObj.time, emoji.emoji)" [style.display]="emoji.count > 0 ? 'flex' : 'none'" *ngFor="let emoji of messageObj.emoji"
                    class="show-reactions">{{emoji.emoji}} {{emoji.count}}
                  </div>
                </div>
            </div>
           
          </div>
          <div *ngIf="showButton[i]"
            [ngClass]="messageObj.ownMessage ? 'own-quick-reactions-container' : 'quick-reactions-container'">
            <mat-icon (click)="addQuickReaction(true, false, messageObj.time)" class="quick-reaction">👍</mat-icon>
            <mat-icon (click)="addQuickReaction(false, true, messageObj.time)" class="quick-reaction">👎</mat-icon>
            <mat-icon (click)="openEmojiDialog($event, false, true, messageObj.time)"
              class="add-reaction-icon">add_reaction</mat-icon>
            <mat-icon class="edit-message-icon" *ngIf="messageObj.ownMessage">more_vert</mat-icon>
          </div>
        </div>
      </ng-container>
    </div>

    <div class="answer-section">
      <div class="answer-field">
        <textarea [(ngModel)]="message" name="answer" id="answerThread" cols="1" rows="40"
          placeholder="Antworten..."></textarea>
        <div class="button-row">
          <div class="d-flex-sb">
            <div class="add w-h-40"></div>
            <div class="vector"></div>
            <div class="emoji w-h-40" (click)="openEmojiDialog($event, true, false)"></div>
            <div class="email w-h-40"></div>
          </div>
          <div (click)="sendMessageToThread(message)" class="send w-h-40"></div>
        </div>
      </div>
    </div>
  </div>
</section>